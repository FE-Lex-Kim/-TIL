# 라우터와 서브넷

## 라우터의 이해

목적지 IP주소를 확인하고 하나 또는 그 이상의 네트워크 간의 패킷의 경로를 선택하여 전송한다.

<br>

Router : 네트워크 간의 패킷을 전송해주는 장비

Routing : 네트워크 간의 패킷을 전달하는 경로를 선택하는 과정, Static & Dynamic

Routed : 라우터가 라우팅을 해주는 대상, IP

<br>

## 서브넷 마스크

<br>

서브넷: 큰 네트워크를 분할되어 나줘진 작은 네트워크이다. 네트워크와 호스트 이렇게 둘로 구분된다.

네트워크를 분할하는 것을 **서브네팅** 이라고한다.

이러한 서브네팅은 **서브넷 마스크**를 통하여 수행되어진다.

<br>

할당된 네트워크 영역을 좀 더 효율적으로 사용하기 위해 서브넷으로 쪼개어 구성한다.

IP 수백개가 주어졌을때 그것을 통으로 사용하는 것이 아닌 인사팀 50개, 경영팀 70개 ... 이런식으로 나누는 것이 효율적이다.

IP주소는 2진수로 변환하여 표현해서 클래스를 구분할 수 있다.

<br>

### 예시

<br>

`11001101 00000000 00000001 xxxxxxxx`

<br>

이 IP주소는 최상위 비트가 11이므로 C Class 네트워크 라고 할 수 있다.

따라서 앞의 24개의 비트는 네트워크 주소이고(`11001101 00000000 00000001`) 뒤의 8개의 비트는 호스트 주소이다.

<br>

기본적으로 C Class 네트워크는 기본 서브넷 마스크로 /24 를 가지고 있다.

<br>

**즉, 서브넷 마스크 값은 네트워크 주소를 나타내는 비트 수를 명시한 값이다.**

**서브넷 마스크가 IP주소의 형태와 비슷하게 생겼다고 해서 IP주소랑 혼동해서는 안된다. 서브넷 마스크 값은 단지 현재 내가 속한 네트워크가 어디까지 네트워크 주소를 표현하는지 명시하는 값일 뿐이다**

<br>

이것을 2진수로 표현하면 `11111111 11111111 11111111 00000000` 으로 표현될 수 있을 것이다.

<br>

여기서 이 네트워크가 가질 수 있는 호스트 주소의 수는 256개 이다.

만약 이 네트워크의 호스트를 128개씩 가지는 두 개의 네트워크로 또 분할하고 싶을때 서브넷으로 분할한다.

<br>

```jsx
11001101 00000000 00000001 1xxxxxxx
11001101 00000000 00000001 0xxxxxxx
```

<br>

위와 같이 네트워크를 분할하고 싶으면, 네트워크 주소를 나타내는 부분이 25자리므로 기존의 C Class 네트워크보다 네트워크 주소를 나타내는 부분이 한 자리가 더 많다.

이때 서브넷 마스크는 /25 라고 표현할 수 있다.

<br>

`205.01.129/25` 와 같이 서브넷 마스크와 같이 표기히여 어디까지 네트워크 주소인지 파악할 수 있다.

<br>

서브넷 마스크를 변경해서 더 분할할 수 있지만 이렇게 분할을 많이하면 하나의 서브넷에서 가질 수 있는 호스트 주소가 줄어들게 되므로, 로컬 네트워크 규모에 따라서 서브넷 마스크 값을 잘 조정하는 것이 필요하다.

<br>

R2는망은 총 6개의 IP가 필요하다.

- 3명(Bob, Kim, Linda)
- 여기 3명을 이어서 R2와 연결할 게이트웨이 주소 1개
- 네트워크 와 브로드캐스트 주소 2개

<br>

디폴트 게이트웨이 :

- 다른 네트워크로 패킷 전송시 거쳐야하는 지점
- 라우터와 라우터가 연결되는, 또는 호스트와 라우터가 연결되는 입구지점.
- 만약 자신의 라우터에서 목적지 IP주소는 자기 대역이 아닐경우 디폴트 게이트웨이와 연결된 다른 라우터로 전달한다.

<br>

## 라우터 동작 방식

<br>

### 동적 라우팅의 개요

<br>

라우팅 프로토콜은 정적(Static) 과 동적(Dynamic)으로 구분된다.

- 정적 라우팅 : 경로 정보를 라우터에 미리 저장하여 패킷을 전송한다.
- 동적 라우팅 : 경로 정보가 네트워크 상황에 따라 더 빠른 경로로 변경되어 패킷을 전송한다.

<br>

동적 라우팅

인접 라우터들과 주기적으로 라우팅 테이블을 교환하여 확인 및 관리한다.

<br>

벨만 포드 알고리즘

- 최단 경로 문제를 풀어주는 알고리즘을 사용해서 계산

<br>

다익스트라 알고리즘

이렇게 두개의 알고리즘을 사용해서 구현한다.

<br>

### Static 라우팅

가장 기본적인 라우팅 방식으로 수동으로 경로를 라우터에 설정하여 패킷을 처리한다.

일반적으로 가장 많이 쓰이는 방식이다.

<br>

경로는 라우팅 테이블에 목적지 IP주소와 인터페이스 정보를 설정한다.

<br>

인터페이스 : 해당 목적지 IP주소로 도착하기 위해 거쳐가는 경로

<br>

- 각 PC의 정적 라우팅 테이블 작성

  자신의 대역을 제외하고 전부 인접한 라우터(게이트웨이)로 경로를 설정한다. 보통 디폴트 게이트웨이만 설정한다.

- 각 라우터 들의 정적 라우팅 테이블 작성

  라우터 들의 정적 라우팅 테이블 구성 요소

  - 커넥티드 : 포트에 직접 연결된 네트워크 대역, 이미 설정이 되어있어 설정 필요가 없다.
  - 정적 : 각 PC의 IP주소에 대해 1:1 대응으로 해당 PC의 라우터로 가기위한 경로의 라우터 게이트웨이를 설정한다.

  - 디폴트 라우팅 : 0.0.0.0 은 모든 네트워크 이다. 만약 자신의 라우팅 테이블에 없는 대역이면 자신은 모르겠으니 다른 라우터에 던져서 처리하라고 넘긴다.

    즉, 0.0.0.0은 모든 네트워크 이므로 라우팅 테이블에 없는 네트워크 주소는 이에해당 한다. 이때 상위 게이트웨이에 던진다로 설정해준다.

<br>

정리

1. 라우터의 라우터 테이블을 확인
2. 없으면 디폴트 게이트웨이에 넘김

1, 2번 반복해서 목적지 도착

<br>

### Hop & TTL

전세계 네트워크 호스트는 IP 라우팅을 통해 연결되어 있다.

Hop : 소스와 목적지 간의 경로, 라우터와 라우터

TTL(Time to Live) : 패킷이 폐기되기전 hop 카운트

<br>

각 라우터는 패킷이 인입되면 TTL 값을 1씩 감소,

TTl = 0 이 되면 폐기된다, 부정확한 패킷의 루프 방지하기 위해서 이다.

<br>

### Tranceroute or Tracert

라우팅 경로 확인 명령어

<br>

출발지에서 목적지 IP까지 거치는 라우터 최적 경로 확인

<br>

## 정리

- 라우터는 목적지 IP 주소를 확인하고 하나 또는 그 이상의 네트워크 간의 패킷 경로를 선택하여 전송한다.
- 서브넷 마스크는 네트워크를 여러개 작은 부분 네트워크로 구성하는 것이다.
- Statci 라우팅은 라우팅 테이블의 목적지 IP와 Next Hop을 참조하여 경로를 선택한다.
- 라우팅 테이블은 커넥티드, 수동(정적), 디폴트 라이팅 설정이 포함된다.

<br>

참고

- 패스트캠퍼스 네트워크 강의
- [https://hyoje420.tistory.com/32](https://hyoje420.tistory.com/32)
