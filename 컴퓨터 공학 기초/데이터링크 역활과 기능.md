# 데이터 링크 계층의 역활과 기능

<br>

## 데이터 링크 계층이란?

### 역활

- OSI 7 Layer의 2계층으로 인접한 네트워크 노드끼리 데이터를 전송하는 기능과 절차를 제공
- 물리계층에서 발생하는 오류 감지, 수정
- 대표적인 프로토콜로 이더넷이 있고 장비로 스위치가 있다.

<br>

2계층에서는 Frame 단위로 데이터를 주고 받는다.

<br>

### 2개의 부 계층으로 구성

- MAC : 물리적인 부분으로 매체간의 연결방식을 제어하고 1계층과 연결
- LLC : 논리적인 부분으로 Frame을 만들고 3계층과 연결

![데이터 링크 역활과 기능](../Images/물리계층%20역활과%20기능/데이터링크%20역활과%20기능/데이터%20링크%20역활과%20기능-1.png)

### MAC 주소

물리적인 주소인 MAC을 가지고 있다.

48bit(6 Bytes)로 6자리로 구성, 각 16진수로 표현한다.

<br>

앞에 3자리는 OUI(제조사 식별코드)

<br>

## 주요 기능

### Framing

데이터그램을 캡슐화하여 프레임 단위로 만들고 헤더와 트레일러를 추가

<br>

헤더는 목적지, 출발지 주소 그리고 데이터 내용을 정의

트레일러는 비트 에러를 감지한다.

<br>

![데이터 링크 역활과 기능](../Images/물리계층%20역활과%20기능/데이터링크%20역활과%20기능/데이터%20링크%20역활과%20기능-2.png)

### 회선 제어

신호간의 충돌이 발생하지 않도록 제어한다.

회선제어를 하는 방법은 여러가지가 있다.

<br>

- ENQ / ACK 방법 : 전용 전송 링크 1 : 1

  1. PC1이 ENQ를 전송한뒤 PC2는 ENQ를 잘 받았으면 ACK를 PC1에게 전송한다.
  2. 이후 PC1은 ACK를 통해 수신 PC가 잘받은것을 확인한뒤 Data를 보낸다.
  3. 이후 PC2는 다시 ACK를 보내 Data를 받은것을 응답해준다.
  4. PC1은 모든 data를 주고 받았으니 EOT로 종료하는 frame을 보낸다.

<br>

- Polling 방법, 1 : 다
  - select 모드 : 송신자가 나머지 수신자들을 선택하여 전송
  - poll 모드 : 수신자에게 데이터 수신여부를 확인하여 응답을 확인하고 전송- multipoint

<br>

### 흐름 제어

송신자와 수신자의 데이터를 처리하는 속도 차이를 해결하기 위한 제어

<br>

Stop & Wait 방식

sliding window 방식 2가지가 있다.

<br>

ex) PC1은 초당 1gb의 속도를 보낼수있고 PC2는 10megab 속도만큼만 처리할 수 있으면, 이런 속도차이를 PC2가 처리할 수 있는 만큼만 보내는 방식

<br>

### Stop & Wait 방식

- PC1이 송신, PC2가 수신일때,

  1. PC1이 PC2에게 Frame(데이터)을 보내주고
  2. PC2는 ACK을 응답을 해주고 PC1은 ACK응답이 올때까지 기다려준다.
  3. PC1은 다시 Frame을 보내준뒤 ACK이 올때까지 기다려준다.
  4. PC2는 Frame을 받은뒤 ACK을 보내준다.

  시간이 비효율적으로 동작한다.

<br>

- Frame을 전달하고 ACK이 회선 문제로 응답하지 않는 경우

  1. Frame(데이터)를 PC1이 보내고 ACK 응답이 올때까지 기다린다.
  2. ACK이 오지않으면 일정시간후 다시 보낸다.
  3. Retransmit frame을 다시보낸다.
  4. 다시 PC2는 ACK을 보내 받은것을 응답해준다.

<br>

- Frame을 재전송하게 되면 Duplicate frame 문제가 발생할 수 있다.

  sequence number(1 bit)를 사용해서 동일한 frame인지 구분한뒤 전달한다.

  1. frame을 보낼때 sequence number을 사용해서 같이 보내준다.
  2. PC2가 에러가 나서 ACK를 응답하지 못하면
  3. PC1은 다시 frame을 동일한 sequence number와 함께 전송한다.
  4. 이후 PC2가 제대로 받았으면 PC2는 ACK를 응답해준다.
  5. 이후 PC1은 다음 frame과 다음sequence number을 전송해준다.

  시퀀스 넘버를 확인하여 중복 데이터를 확인

<br>

### Stop & Wait 방식이 아닌 Sliding window 방식

ACK 응답 없이 여러개의 프레임이 연속으로 전송가능

Stop & Wait 방식은 비효율적으로 하나씩 보내게되 시간이 오래걸린다.

<br>

Window size는 전송과 수신측의 데이터가 저장되는 버퍼의 크기가 된다.

송신측은

1. frame 전송 후 Window size 축소한다.
2. ACK 수신 후 Windwo size를 확장한다.

<br>

수신측은

1. 현재 ACK - 이전 보내는 ACK = Window size

<br>

### 오류 제어

전송 중에 오류나 손실 발생시 수신측은 에러를 탐지 및 재전송

ARQ : 프레임 손상시 재전송이 수행되는 과정

- Stop & Wait ARQ

  1. 전송 측에서 NAK을 수신하면 재전송
  2. 주어진 시간에 ACK이 안오면 재전송

<br>

- Go Back n ARQ : slide window 방식 ARQ

  1. 전송측 Frame 6개 전송
  2. 수신측 3번 Frame 문제 발생
  3. 수신측 NAK 3으로 손상 응답
  4. 전송측 3번이 포함된 345 재전송

  이렇게 뒤에 오는 모든 Frame까지 버려야하므로 Selective Repeat ARQ 방식이 있다.

  손상된 Frame만 선별해서 재전송한다.

  알고리즘이 복잡해지고 cpu가 올라가야한다는 점이 있다.

<br>

## 이더넷 프레임 구조

### Ethernet v2

데이터 링크 계층에서 MAC 통신과 프로토콜의 형식을 이더넷이라고 한다.

![데이터 링크 역활과 기능](../Images/물리계층%20역활과%20기능/데이터링크%20역활과%20기능/데이터%20링크%20역활과%20기능-3.png)

<br>

Dest Addr : 목적지 MAC 주소 , src Addr : 출발지 MAC 주소

Type : 캡슐화 되어있는 패킷의 프로토콜 정의(상위 계층, 대부분 IPv4 어떤 프로토콜인지 타입)

Data : 상위 계층의 데이터로 45 ~ 1500 바이트의 크기, 46 바이트보다 작으면 뒤에 패딩이 붙는다

FCS(frame check sequence) : 에러 체크

<br>

## 정리

- 데이터 링크 계층은 인접한 네티워크 노드끼리 데이터를 전송하는 기능과 절차를 제공
- 2개의 부계층 MAC, LLC로 구성
- 주요기능으로 Framing, 회선제어, 흐름제어, 오류제어 등이 있다.
- 이더넷 프레임 구조
