# 서버 인증 방법 : JWT vs 세션 / 쿠키

<br>

## JWT

<br>

서버와 클라이언츠가 정보를 주고받을때 누구의 요청인지 정확히 알아야 정보가 유출되는 것을 막을 수 있다.

<br>

JWT는 JSON Web Token의 약자이다.

JSON Web Token (JWT)은 서버와 클라이언츠가 정보를 주고 받을때 HTTP 리퀘스트 헤더에 JSON 토큰을 넣어 정보를 안전성 있게 전달해준다.

<br>

### 토큰을 생성 방법

<br>

**Header**

- 암호화할 방식, 타입 등이 들어간다

<br>

**Payload**

- 유저의 고유의 ID값, 유효기간과 같이 서버에서 보낼 데이터가 들어간다.

<br>

**Verify Signature**

- Header와 payload가 인코딩 되어있고 SECRET KEY를 더해진다.

<br>

이렇게 인코딩된 header와 인코딩된 payload이 verify Signature와 합쳐져서 보낸다.

인코딩이 되었다는 것은 누구나 디코딩을해 header와 payload의 값을 알아낼 수 있다는 의미이다.

하지만 Verify Signature는 SECRET KEY를 알지 못하면 토큰을 조작할 수 없다.

<br>

### 인증 과정

<br>

1. 클라이언츠가 로그인을 한다.
2. 서버에서 payload의 계정 정보를 읽어 DB에서 사용자를 확인 한후, 사용자의 고유한 ID값을 부여하여 payload에 넣는다.
3. 서버에서 Access Token인 JWT를 유효기간을 설정해 발급 받는다.
4. 클라이언츠에게 SECRET KEY를 이용하여 Access Token을 발급한다.
5. 사용자는 서버와 데이터 통신할때 인증이 필요한 요청마다 해더에 토큰을 담아 보낸다.
6. 서버에서 해당 토큰의 Verify Signature를 SECRET KEY로 디코딩 한후 확인한다.
7. 검증을 완료하면 데이터를 가져와 클라이언츠에게 요청에대한 데이터를 응답해준다.

<br>

보통 인증 방식을 세션 / 쿠키와 JWT를 이용한 방법을 비교할 수 있다.

<br>

## 세션 / 쿠키

<br>

### 인증 과정

<br>

1. 클라이언츠가 로그인을 한다.
2. 서버에서 로그인 정보를 읽어 사용자를 DB에서 확인한다.
3. 그 사용자 정보를 사용자의 고유한 ID를 부여하여 세션 저장소에 저장한다.
4. 이때 세션 저장소와 연결되는 세션 ID를 같이 발행한다.
5. 클라이언츠는 서버에서 해당 세션 ID를 받아 쿠키에 저장한다.
6. 인증이 필요할때마다 쿠키를 헤더에 실어서 보낸다.
7. 서버에서 쿠키를 받아서 세션 저장소에서 비교하여 검증한후 데이터를 응답한다.

<br>

**세션ID**

→ 세션과 쿠키 개념 비교: 쿠키는 세션ID를 담고있어 서버의 세션을 열기위한 열쇠와 비슷하다.

<br>

장점

- 서버와 클라이언츠가 세션ID를 가진 쿠키를 가지고 인증을 거친다.

  → 쿠키는 서버의 세션 저장소의 유저 정보를 열기위한 열쇠이므로 유의미한 값을 가지고 있지 않아 보안이 보다 안전하다.

- 세션 / 쿠키를 이용하여 매번 사용자의 정보를 일일이 확인하는 것이 아니여서 편리하다.
- 세션 저장소를 이용하여 서버에 저장소가 필요하므로 서버 자원을 아낄 수 있다.

<br>

단점

- 다른 사용자가 쿠키를 해킹하여 가로채면 서버에서 세션저장소에서 정보를 내어줄수있다.

<br>

## 세션 / 쿠키 vs JWT 차이점

<br>

### 세션 / 쿠키

세션 쿠키는 세션 저장소에 유저의 정보를 넣는다.

<br>

### JWT

JWT는 토큰에 유저의 정보를 담는다.

<br>

장점

- 세션/쿠키와 다르게 저장소 관리가 필요 없어 단지 토큰 발급이후 검증을 하면 되어 간편하다.

  → 이는 저장소를 사용하지 않는 다는것은 서버를 유지 보수하는데 유리하다.

- 단지 로그인에서만 토큰을 사용하는 것이아닌 권한을 받는 등의 토큰을 사용하는 확장성도 뛰어나다.

<br>

단점

- 이미 발급된 JWT는 유효기간이 완료 될때까지 계속 사용, 따라서 악의적인 사용자는 정보를 가져간다.
- payload의 정보를 암호화 하지 않아 디코딩만하면 정보를 확인 할 수 있으므로 중요한 정보를 payload에 넣을 수 없다.

<br>

클라이언츠에서는 해더에 세션ID나 토큰을 보내는것에는 동일하지만

서버에서는 인증을 위해서 토큰을 암호화 하는지, 별도의 저장소를 이용하는지 차이가 난다.

<br>

참고

- [https://velopert.com/2389](https://velopert.com/2389)
- [https://tansfil.tistory.com/58](https://tansfil.tistory.com/58)
